<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Input Nilai Siswa</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .hidden { display: none; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f0f0f0; }
    input[type="number"] { width: 60px; }
  </style>
</head>
<body>
  <h2>Login Guru</h2>
  <label>Mata Pelajaran:</label>
  <select id="mapel">
    <option value="">-- Pilih --</option>
    <option>PAK</option><option>PKN</option><option>B.IND</option><option>B.ING</option>
    <option>MATE</option><option>IPA</option><option>IPS</option><option>PRAKARYA</option>
    <option>TIK</option><option>PJOK</option><option>MULOK</option><option>LAINNYA</option>
  </select><br><br>

  <label>Kelas:</label>
  <select id="kelas">
    <option value="">-- Pilih --</option>
    <option>7a</option>
    <option>7b</option>
    <option>8a</option>
    <option>8b</option>
    <option>9a</option>
    <option>9b</option>
  </select><br><br>

  <label>Password:</label>
  <input type="password" id="password"><br><br>

  <button onclick="login()">Login</button>

  <div id="input-nilai" class="hidden">
    <h3>Input Nilai Siswa</h3>
    <form onsubmit="kirim(event)">
      <table id="tabel-nilai">
        <thead>
          <tr><th>Nama</th><th>Nilai</th></tr>
        </thead>
        <tbody></tbody>
      </table><br>
      <button type="submit">Kirim</button>
    </form>
  </div>

  <script>
    const PASSWORD = "123";
    let mapelTerpilih = "", kelasTerpilih = "";

    async function login() {
      mapelTerpilih = document.getElementById("mapel").value;
      kelasTerpilih = document.getElementById("kelas").value;
      const pass = document.getElementById("password").value;

      if (!mapelTerpilih || !kelasTerpilih || pass !== PASSWORD) {
        alert("Data tidak lengkap atau password salah!");
        return;
      }

      const res = await fetch("siswa.txt");
      const teks = await res.text();
      const siswa = teks.trim().split("\n").filter(baris => {
        const [_, kelas] = baris.split(";");
        return kelas.trim().toLowerCase() === kelasTerpilih;
      });

      const tbody = document.querySelector("#tabel-nilai tbody");
      tbody.innerHTML = "";
      siswa.forEach(baris => {
        const [nama] = baris.split(";");
        const row = document.createElement("tr");
        row.innerHTML = `<td>${nama}</td><td><input type="number" name="nilai" min="0" max="100" data-nama="${nama}"></td>`;
        tbody.appendChild(row);
      });

      document.getElementById("input-nilai").classList.remove("hidden");
    }

    async function kirim(e) {
      e.preventDefault();
      const nilaiInputs = document.querySelectorAll("input[name='nilai']");
      const data = Array.from(nilaiInputs).map(input => ({
        nama: input.dataset.nama,
        kelas: kelasTerpilih.toUpperCase(),
        mapel: mapelTerpilih,
        nilai: input.value
      }));

      for (const entri of data) {
        await fetch("https://script.google.com/macros/s/AKfycbzHVbLYw4EcC6iUxb2OJXSP42mp5G8yGLqT2SNwkXSAfbjLIGM7CQ1aK-ul2YviN9bYzQ/exec", {
          method: "POST",
          body: new URLSearchParams(entri)
        });
      }

      alert("Nilai berhasil dikirim!");
    }
  </script>
</body>
</html>
